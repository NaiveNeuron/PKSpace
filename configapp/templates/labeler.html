<!DOCTYPE html>
<html lang="en">
<head>
    <title>PKSpace labeler app</title>
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery-ui.min.js') }}"></script>

    <link rel="stylesheet" type="text/css"
        href="{{ url_for('static', filename='css/jquery-ui.min.css') }}">
    <link rel="stylesheet" type="text/css"
        href="{{ url_for('static', filename='css/labeler.css') }}">
</head>

<body>
  {% if nojson %}
  <div id="labeler-header">
    <h1>No json file with polygons found</h1>
    <h3>Please <a href="{{ url_for('marker') }}">generate</a> one</h3>
  </div>

  {% else %}
  <div id="tabs">
    <ul>
    {% for tab in tabs %}
      <li><a href="#{{ tab }}">{{ tab }}</a></li>
    {% endfor %}
    </ul>

    {% for subdir, images in imgs.iteritems() %}
      <div id="{{ subdir }}">
        {% for img in images %}
        <span id="{{ img.src }}" {% if img.labeled %}class="green"{% endif %}>
          {{ img.src }}
        </span>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <div id="labeler-header">
    <p>JSON output will be automatically saved into folder where the image
       was loaded from</p>
    <button id="savelabel">Save labeled image</button>
  </div>

  <div id="labeler-container">
    <canvas id="labcanvas" width="640" height="480">
      Your browser does not support the HTML5 canvas tag.
    </canvas>
  </div>

  <script src="{{ url_for('static', filename='js/labeler.js') }}"></script>
  <script>
    
    $(document).ready(function () {
        $('#tabs').tabs();
        
        var labeler = new Labeler();
        labeler.load_polygons('{{ polygons }}');


        $('#tabs > div > span').click(function(e) {
            labeler.change_image($(this).attr('id'));
        });

        $('#labcanvas').click(function(e){
            if (labeler.image != null) {
                labeler.clicked(e.pageX, e.pageY);
            }
        });

        $('#savelabel').click(function(e) {
            labeler.save();
        });
    });
  </script>
  {% endif %}

</body>
</html>
